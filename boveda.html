<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vault Logic | Executive Bóveda</title>
    <style>
        :root {
            --gold: #d4af37;
            --alert: #ff4d4d;
            --safe: #00ff88;
            --dark: #050505;
        }

        body { 
            background: radial-gradient(circle at center, #1a1a1a 0%, var(--dark) 100%); 
            color: var(--gold); 
            font-family: 'JetBrains Mono', monospace; 
            display: flex; justify-content: center; align-items: center; 
            min-height: 100vh; margin: 0; padding: 20px;
        }

        .report-container { 
            background: rgba(10, 10, 10, 0.98);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(212, 175, 55, 0.2); 
            padding: 50px; max-width: 900px; width: 100%; 
            box-shadow: 0 50px 100px rgba(0, 0, 0, 0.95); 
            display: none; position: relative;
        }

        h1 { letter-spacing: 0.6em; font-size: 1.1rem; text-align: center; margin-bottom: 50px; color: var(--gold); font-weight: 300; border-bottom: 1px solid #222; padding-bottom: 20px;}
        
        /* DATA ROWS - ENFOQUE CORPORATIVO */
        .data-row { margin: 40px 0; border-left: 4px solid var(--gold); padding-left: 35px; }
        .label { font-size: 0.85rem; color: #555; letter-spacing: 0.3em; text-transform: uppercase; margin-bottom: 8px; display: block; }
        .value { font-size: 2.6rem; color: #ffffff; font-weight: 600; letter-spacing: -1px; text-shadow: 0 0 20px rgba(255,255,255,0.1); }

        /* SECCIÓN GRÁFICA TÉCNICA */
        .wheel-section { display: flex; align-items: center; justify-content: space-around; gap: 20px; margin: 60px 0; }
        
        .side-metrics { width: 200px; display: flex; flex-direction: column; gap: 30px; }
        .metric-box { border-top: 1px solid #222; padding-top: 15px; }
        .metric-label { font-size: 0.7rem; color: #666; letter-spacing: 0.15em; text-transform: uppercase; }
        .metric-val { font-size: 1.1rem; color: #fff; margin-top: 8px; font-weight: bold; }

        #canvas-container { 
            background: radial-gradient(circle, #0a0a0a 0%, #000 100%);
            border: 1px solid #222; border-radius: 50%; 
            width: 380px; height: 380px; display: flex; align-items: center; justify-content: center; 
            box-shadow: inset 0 0 50px rgba(212, 175, 55, 0.05);
            position: relative;
        }

        #canvas-container::after {
            content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            border-radius: 50%; border: 1px solid rgba(212, 175, 55, 0.1);
            animation: pulse 4s infinite ease-in-out;
            pointer-events: none;
        }

        @keyframes pulse { 0% { transform: scale(1); opacity: 0.5; } 50% { transform: scale(1.05); opacity: 0.2; } 100% { transform: scale(1); opacity: 0.5; } }

        .directiva { 
            background: rgba(212, 175, 55, 0.03); padding: 40px; border: 1px solid rgba(212, 175, 55, 0.1);
            margin-top: 45px; color: #fff; font-size: 1.3rem; line-height: 1.7; text-align: left;
            border-left: 5px solid var(--gold);
        }

        /* BOTÓN NASA STYLE CON RELIEVE */
        .btn-nasa {
            background: var(--gold); color: #000;
            border: 1px solid var(--gold);
            outline: 1px solid var(--gold); outline-offset: 2px;
            padding: 22px 45px; font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem; font-weight: bold; letter-spacing: 0.3em;
            cursor: pointer; transition: all 0.3s ease; text-transform: uppercase;
            width: 100%; margin-top: 20px;
        }
        .btn-nasa:hover {
            background: #ffffff; color: #000; border-color: #ffffff; outline-color: #ffffff;
            box-shadow: 0 0 30px rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .upgrade-card {
            margin-top: 60px; padding: 60px; border: 1px solid #1a1608;
            background: linear-gradient(180deg, #0a0a0a 0%, #0d0b04 100%); text-align: center;
        }

        .tech-auth {
            margin-top: 60px; padding-top: 30px; border-top: 1px solid #111;
            font-size: 0.65rem; color: #333; text-align: justify; line-height: 1.6;
            letter-spacing: 0.05em;
        }
    </style>
</head>
<body>

<div id="loading" style="letter-spacing: 0.5em; font-size: 0.8rem;">ESTABLECIENDO CONEXIÓN CON NÚCLEO NASA/JPL...</div>

<div class="report-container" id="reporte">
    <h1>VAULT LOGIC // EXECUTIVE TERMINAL</h1>

    <div class="data-row">
        <span class="label">Sujeto de Análisis</span>
        <div class="value" id="nombre">---</div>
    </div>

    <div class="wheel-section">
        <div class="side-metrics" style="text-align: right;">
            <div class="metric-box">
                <span class="metric-label">Nodos Activos</span>
                <div class="metric-val">10/10 [SECURE]</div>
            </div>
            <div class="metric-box">
                <span class="metric-label">Precisión Angular</span>
                <div class="metric-val">±0.0001°</div>
            </div>
        </div>

        <div id="canvas-container">
            <canvas id="vaultWheel" width="380" height="380"></canvas>
        </div>

        <div class="side-metrics" style="text-align: left;">
            <div class="metric-box">
                <span class="metric-label">Vectores Tensión</span>
                <div class="metric-val" style="color: var(--alert);" id="tension-count">CALCULANDO...</div>
            </div>
            <div class="metric-box">
                <span class="metric-label">Cálculo Eclíptico</span>
                <div class="metric-val">GEOCÉNTRICO</div>
            </div>
        </div>
    </div>

    <div class="directiva">
        <span class="label" style="color: var(--gold); margin-bottom: 20px; display: block;">Directiva de Sincronía:</span>
        <div id="directiva" style="font-weight: 300;">---</div>
    </div>

    <div class="upgrade-card">
        <h4 style="color: var(--gold); letter-spacing: 0.4em; margin-bottom: 25px; font-size: 0.9rem;">SISTEMA GÉNESIS: NIVEL DE CONTROL REQUERIDO</h4>
        <p style="color: #666; margin-bottom: 40px; font-size: 0.8rem; line-height: 1.8; letter-spacing: 0.05em; max-width: 650px; margin-left: auto; margin-right: auto;">
            "Su infraestructura revela vectores de alta complejidad que superan el análisis estándar Sentinel. Para operar sobre estos nodos y habilitar el Simulador de Escenarios de 10 años, se requiere la activación del núcleo GÉNESIS."
        </p>
        <button class="btn-nasa" onclick="prepararSalto()">ACTIVAR CENTRO DE COMANDO GÉNESIS</button>
    </div>

    <div class="tech-auth">
        <p><strong>PROTOCOL ID:</strong> GX-992-B // DATA SOURCE: NASA JPL DE441 // ENGINE: SWISS EPHEMERIS 2.10</p>
        <p>Los datos visualizados corresponden a la proyección matemática de tránsitos de Kepler aplicados a la raíz georreferenciada del sujeto. Este reporte constituye un activo de inteligencia estratégica bajo licencia técnica de alta precisión.</p>
    </div>
</div>

<script>
    function prepararSalto() {
        const btn = document.querySelector('.btn-nasa');
        btn.innerText = "INICIALIZANDO PROTOCOLO GÉNESIS...";
        btn.disabled = true;
        setTimeout(() => { window.location.href = 'suscripcion.html'; }, 1200);
    }

   // Sustituir la función dibujarRueda por un generador de SVG
function renderizarVectoresSVG(vectores, aspectos) {
    const container = document.getElementById('canvas-container');
    const centro = 190; const radio = 145;
    
    let contenidoSVG = `<svg viewBox="0 0 380 380" style="width:100%; height:100%;">
        <circle cx="${centro}" cy="${centro}" r="${radio}" fill="none" stroke="rgba(212,175,55,0.1)" stroke-width="1" />`;

    // Dibujar Aspectos (Líneas de Tensión)
    aspectos.forEach(asp => {
        const p1 = vectores[asp.puntos.split('-')[0]];
        const p2 = vectores[asp.puntos.split('-')[1]];
        if (p1 !== undefined && p2 !== undefined) {
            const x1 = centro + radio * Math.cos((p1 - 90) * Math.PI / 180);
            const y1 = centro + radio * Math.sin((p1 - 90) * Math.PI / 180);
            const x2 = centro + radio * Math.cos((p2 - 90) * Math.PI / 180);
            const y2 = centro + radio * Math.sin((p2 - 90) * Math.PI / 180);
            
            const color = (asp.tipo === 'OPOSICIÓN') ? 'var(--alert)' : 'var(--safe)';
            const dash = (asp.tipo === 'OPOSICIÓN') ? '5,5' : '0';
            contenidoSVG += `<line x1="${x1}" y1="${y1}" x2="${x2}" y2="${y2}" stroke="${color}" stroke-dasharray="${dash}" opacity="0.5" />`;
        }
    });

    // Dibujar Nodos
    Object.entries(vectores).forEach(([nombre, grado]) => {
        const x = centro + radio * Math.cos((grado - 90) * Math.PI / 180);
        const y = centro + radio * Math.sin((grado - 90) * Math.PI / 180);
        contenidoSVG += `
            <circle cx="${x}" cy="${y}" r="4" fill="#fff">
                <animate attributeName="opacity" values="1;0.5;1" dur="2s" repeatCount="indefinite" />
            </circle>
            <text x="${x + 12}" y="${y + 4}" fill="var(--gold)" font-size="9" font-family="JetBrains Mono">${nombre.toUpperCase()}</text>`;
    });

    contenidoSVG += `</svg>`;
    container.innerHTML = contenidoSVG;
}

   // Reemplaza la función cargarReporte en boveda.html
async function cargarReporte() {
    const email = new URLSearchParams(window.location.search).get('email');
    if (!email) return;

    try {
        const response = await fetch(`https://vault-strategy-api.onrender.com/obtener_reporte/${encodeURIComponent(email)}`);
        const res = await response.json();

        if (res.status === "success") {
            const d = res.data;
            document.getElementById('nombre').innerText = d.nombre.toUpperCase();
            document.getElementById('directiva').innerText = d.directiva;
            
            // Forzar visualización de contenedores
            document.getElementById('loading').style.display = 'none';
            document.getElementById('reporte').style.display = 'block';

            // Verificación crítica de datos para el canvas
            if (d.mapatotal && d.mapatotal.vectores_eclipticos) {
                console.log("Datos recibidos, iniciando trazado...");
                // Pequeño delay para asegurar que el DOM del canvas sea visible
                setTimeout(() => {
                    dibujarRueda(d.mapatotal.vectores_eclipticos, d.mapatotal.analisis_kepler || []);
                }, 300);
            }
        }
    } catch (e) {
        console.error("Error en Bóveda:", e);
        document.getElementById('loading').innerText = "ERROR CRÍTICO: NÚCLEO NO DISPONIBLE";
    }
}
    window.onload = cargarReporte;
</script>
</body>
</html>
