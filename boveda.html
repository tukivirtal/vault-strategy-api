<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Vault Logic | Executive Bóveda</title>
    <style>
        :root { --gold: #d4af37; --alert: #ff4d4d; --safe: #00ff88; --dark: #050505; }
        body { background: radial-gradient(circle, #1a1a1a 0%, var(--dark) 100%); color: var(--gold); font-family: 'JetBrains Mono', monospace; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .report-container { background: rgba(10, 10, 10, 0.98); border: 1px solid rgba(212, 175, 55, 0.2); padding: 50px; max-width: 900px; width: 100%; display: none; }
        h1 { letter-spacing: 0.6em; font-size: 1.1rem; text-align: center; border-bottom: 1px solid #222; padding-bottom: 20px; }
        .data-row { margin: 40px 0; border-left: 4px solid var(--gold); padding-left: 35px; }
        .value { font-size: 2.6rem; color: #fff; font-weight: 600; }
        .wheel-section { display: flex; align-items: center; justify-content: space-around; margin: 60px 0; }
        #canvas-container { width: 380px; height: 380px; display: flex; align-items: center; justify-content: center; position: relative; }
        .directiva { background: rgba(212, 175, 55, 0.03); padding: 30px; border: 1px solid rgba(212, 175, 55, 0.1); border-left: 5px solid var(--gold); margin-top: 40px; color: #fff; }
        .btn-nasa { background: var(--gold); color: #000; border: none; padding: 20px; width: 100%; font-weight: bold; letter-spacing: 0.3em; cursor: pointer; text-transform: uppercase; margin-top: 30px; outline: 1px solid var(--gold); outline-offset: 3px; }
        .footer-tech { margin-top: 50px; padding-top: 20px; border-top: 1px solid #222; font-size: 0.6rem; color: #444; line-height: 1.6; }
    </style>
</head>
<body>
    <div id="loading">CONECTANDO CON NÚCLEO NASA/JPL...</div>
    <div class="report-container" id="reporte">
        <h1>VAULT LOGIC // EXECUTIVE TERMINAL</h1>
        <div class="data-row">
            <span style="font-size: 0.7rem; color: #555; letter-spacing: 0.2em;">SUJETO DE ANÁLISIS</span>
            <div class="value" id="nombre">---</div>
        </div>
        <div class="wheel-section">
            <div style="text-align: right; font-size: 0.7rem; color: #666;">NODOS ACTIVOS<br><b style="color:#fff">10/10 [SECURE]</b></div>
            <div id="canvas-container"></div>
            <div style="text-align: left; font-size: 0.7rem; color: #666;">VECTORES TENSIÓN<br><b id="tension-count" style="color:var(--alert)">CALCULANDO...</b></div>
        </div>
        <div class="directiva">
            <span style="font-size: 0.7rem; color: var(--gold); display: block; margin-bottom: 10px;">DIRECTIVA DE SINCRONÍA:</span>
            <div id="directiva">---</div>
        </div>
        <button class="btn-nasa" onclick="location.href='suscripcion.html'">ACTIVAR CENTRO DE COMANDO GÉNESIS</button>
        <div class="footer-tech">
            PROTOCOL ID: GX-992-B // DATA SOURCE: NASA JPL DE441 // PRECISION: ±0.0001°<br>
            Este reporte constituye un activo de inteligencia estratégica bajo licencia técnica.
        </div>
    </div>

    <script>
// MOTOR DE RENDERIZADO SVG - INGENIERÍA NASA JPL
function renderizarVectoresSVG(vectores, aspectos) {
    const container = document.getElementById('canvas-container');
    if (!container) return;
    
    const centro = 190; const radio = 145;
    
    // Si no hay vectores aún, dejamos un círculo de carga
    if (!vectores) {
        container.innerHTML = `<svg viewBox="0 0 380 380"><circle cx="190" cy="190" r="145" fill="none" stroke="#222" stroke-width="1" stroke-dasharray="5,5"/></svg>`;
        return;
    }

    let svg = `<svg viewBox="0 0 380 380" style="width:100%; height:100%;">
        <defs>
            <filter id="glow"><feGaussianBlur stdDeviation="2.5" result="coloredBlur"/><feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
        </defs>
        <circle cx="${centro}" cy="${centro}" r="${radio}" fill="none" stroke="rgba(212,175,55,0.15)" stroke-width="1.5" />
        <circle cx="${centro}" cy="${centro}" r="${radio + 12}" fill="none" stroke="rgba(212,175,55,0.05)" stroke-width="1" />`;

    // 1. Dibujar Líneas de Tensión/Armonía
    if (aspectos) {
        aspectos.forEach(asp => {
            const p1 = vectores[asp.puntos.split('-')[0]];
            const p2 = vectores[asp.puntos.split('-')[1]];
            if (p1 !== undefined && p2 !== undefined) {
                const x1 = centro + radio * Math.cos((p1 - 90) * Math.PI / 180);
                const y1 = centro + radio * Math.sin((p1 - 90) * Math.PI / 180);
                const x2 = centro + radio * Math.cos((p2 - 90) * Math.PI / 180);
                const y2 = centro + radio * Math.sin((p2 - 90) * Math.PI / 180);
                const color = (asp.tipo === 'OPOSICIÓN' || asp.tipo === 'CUADRATURA') ? '#ff4d4d' : '#00ff88';
                svg += `<line x1="${x1}" y1="${y1}" x2="${x2}" y2="${y2}" stroke="${color}" stroke-width="1.5" stroke-dasharray="${asp.tipo === 'OPOSICIÓN' ? '5,5' : '0'}" opacity="0.6" />`;
            }
        });
    }

    // 2. Dibujar Nodos (Planetas)
    Object.entries(vectores).forEach(([nombre, grado]) => {
        const x = centro + radio * Math.cos((grado - 90) * Math.PI / 180);
        const y = centro + radio * Math.sin((grado - 90) * Math.PI / 180);
        svg += `<circle cx="${x}" cy="${y}" r="5" fill="#fff" filter="url(#glow)" />
                <text x="${x + 15}" y="${y + 5}" fill="#d4af37" font-size="11" font-family="JetBrains Mono" font-weight="bold">${nombre.toUpperCase()}</text>`;
    });

    container.innerHTML = svg + `</svg>`;
}

async function cargarReporte() {
    const email = new URLSearchParams(window.location.search).get('email');
    if (!email) return;

    try {
        const response = await fetch(`https://vault-strategy-api.onrender.com/obtener_reporte/${encodeURIComponent(email)}`);
        const res = await response.json();

        if (res.status === "success") {
            const d = res.data;
            document.getElementById('nombre').innerText = d.nombre.toUpperCase();
            document.getElementById('directiva').innerText = d.directiva;
            document.getElementById('loading').style.display = 'none';
            document.getElementById('reporte').style.display = 'block';

            if (d.mapatotal && d.mapatotal.vectores_eclipticos) {
                renderizarVectoresSVG(d.mapatotal.vectores_eclipticos, d.mapatotal.analisis_kepler || []);
            }
        }
    } catch (e) {
        document.getElementById('loading').innerText = "ERROR DE SINCRONÍA CON EL NÚCLEO";
    }
}
window.onload = cargarReporte;
        
    </script>
</body>
</html>
